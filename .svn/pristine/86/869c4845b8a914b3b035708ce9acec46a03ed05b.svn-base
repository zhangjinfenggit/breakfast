<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>今天去哪吃</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="css/base.css">

</head>
<body>
<div class="sel_adress">
    <p class="top"><img src="images/adress.png" alt=""><span>请选择您的取餐点:</span></p>

    <div class="sel_box">
        <select id="subwayLine">
            <option selected="selected">选择路线</option>
            <option >1</option>
        </select>
        <select id="subwayName">
            <option selected="selected">选择地铁站</option>
            <option >2</option>
        </select>
        <select id='subwayOut'>
            <option selected="selected">选择出口</option>
            <option >3</option>
        </select>
    </div>
    <input id="searchShop" type="button" value="确定" class="button">
</div>
<p class="tip">*已为您显示上次使用：<span>苏州街站B1出口 附近商铺</span></p>
<ul class="sel_shops_list">
    <li>
        <img class="buiness_photo" src="images/photo.png"/>
        <div class="buiness_desc">
            <h1>珊瑚包子铺</h1>
            <p class="adress">地址: 惠新西街南口地铁站B1出口向西50米</p>
            <a type="button" href="sel_food.html?shopId=1"  class="button button2">今天吃这家</a>
        </div>
    </li>
</ul>
<script src="js/jquery.js"></script>
<script src="js/layer.js"></script>
<script src="js/js.js"></script>
<script>
$(function () {
    //var ip = 'http://59.45.169.9:8050';
    var ip = 'localhost:8080';
    //三联动
    chooseSubway($('#subwayLine'),{"cityName":"北京","type":1});
    $('#subwayLine').on('change', function () {
        chooseSubway($('#subwayName'),{"subwayLine":$(this).val(),type:2});
    })
    $('#subwayName').on('change', function () {
        chooseSubway($('#subwayOut'),{"subwayName":$(this).val(),type:3});
    })
    //查询店铺
    $('#searchShop').on('click', function () {
        //存储当前用户的取餐地址
        var sessionObj = {
            "subwayLine":$('#subwayLine').val(),
            "subwayName":$('#subwayName').val(),
            "subwayOut":$('#subwayOut').val()
        }
        var takeAddress = JSON.stringify(sessionObj)
        sessionStorage.setItem("key",takeAddress);

        $.ajax({
            type : "post",
            headers: setHeader,
            url : "http://"+ip+"/breakfastApi/weixin/querySubwayLine/",
            data : JSON.stringify({outId:$('#subwayOut').val()}),
            dataType :'json',
            success: function(result) {
                if(result.retCode=='000000'){
                    var list = result.data;
                    var str = ''
                    for(var i=0;i<list.length;i++){
                        str += '<li>\
                                <img class="buiness_photo" src='+list[i].photo+'/>\
                                <div class="buiness_desc">\
                                    <h1>'+list[i].name+'</h1>\
                                    <p class="adress">地址: '+list[i].position+list[i].address+'</p>\
                                    <a type="button" href="sel_food.html?shopId='+list[i].shopId+'"  class="button button2">今天吃这家</a>\
                                </div>\
                                </li>';
                    }
                    $('.sel_shops_list').empty().append(str);
                }else{
                    setTimeoutAlert(result.retMsg);
                }
            }
        });
    })

    //三联动
    function chooseSubway(obj,data){
        $.ajax({
            type : "post",
            headers: setHeader,
            url : "http://"+ip+"/breakfastApi/weixin/subway/",
            data : JSON.stringify(data),
            dataType :'json',
            success: function(result) {
                if(result.retCode=='000000'){
                    var list = result.data;
                    var str = obj.html();
                    //var str = ''
                    for(var i=0;i<list.length;i++){
                        str += '<option value="'+list[i].id+'">'+list[i].name+'</option>';
                    }
                    obj.empty().append(str);
                }else{
                    setTimeoutAlert(data.retMsg);
                }
            }
        });
    }

})

</script>
</body>
</html>